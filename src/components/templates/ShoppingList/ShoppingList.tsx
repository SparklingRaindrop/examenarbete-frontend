import Head from 'next/head';
import { ChangeEvent, useReducer, useState } from 'react';
import { ErrorMsg } from '../../../types/error';
import { Button, Checkbox, Icon, List, ListItem, Main } from '../../elements';
import GroceryItem from './blocks/GroceryItem';

const mockGroceries: Grocery[] = [
    {
        id: '1',
        name: 'tomatoes',
        updated_at: new Date(1672774937044),
        amount: 1,
        item_id: '1',
        isChecked: false
    }, {
        id: '3',
        name: 'onions',
        updated_at: new Date(1672774937044),
        amount: 5,
        item_id: '2',
        isChecked: false
    }
];

type ActionType = 'check';
interface Action {
    type: ActionType;
    id: string;
    checked?: boolean;
}

function reducer(state: Grocery[], action: Action): Array<Grocery> {
    const { type, id } = action;

    if (type === 'check') {
        const { checked } = action;
        if (!checked) {
            throw new Error('Missing required property.');
        }

        return state.map(item => {
            if (item.id === id) {
                item.isChecked = checked;
            }
            return item;
        });

    }
    return state;
}

export default function ShoppingList() {
    const [state, dispatch] = useReducer(reducer, mockGroceries);

    function toggleCheckbox(event: ChangeEvent<HTMLInputElement>, id: string) {
        const checked = event.target.checked;
        dispatch({
            id,
            type: 'check',
            checked,
        });
    }

    return (
        <>
            <Head>
                <title>Shopping List</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <Main>
                <Button label='Generate' />
                <List>
                    {
                        mockGroceries.map(({ id, isChecked, name }) => {
                            return (
                                <GroceryItem
                                    key={id}
                                    id={id}
                                    name={name}
                                    checked={isChecked}
                                    toggleCheckbox={toggleCheckbox}
                                />
                            );
                        })
                    }
                </List>
                <Button
                    variant='ghost'
                    onClick={() => console.log('clicked')}>
                    <Icon name='plus' />
                    Add an Item
                </Button>
            </Main>
        </>
    );
}