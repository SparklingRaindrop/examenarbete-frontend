import Head from 'next/head';
import { ChangeEvent, useEffect, useReducer, useState } from 'react';
import { useGroceries } from '../../../hooks';
import { Button, Checkbox, Icon, List, ListItem, Loading, Main } from '../../elements';
import GroceryItem from './blocks/GroceryItem';
import GroceryList from './blocks/GroceryList';

const mockGroceries: Grocery[] = [
    {
        id: '1',
        name: 'tomatoes',
        updated_at: new Date(1672774937044),
        amount: 1,
        item_id: '1',
        isChecked: false
    }, {
        id: '3',
        name: 'onions',
        updated_at: new Date(1672774937044),
        amount: 5,
        item_id: '2',
        isChecked: false
    }
];

export default function ShoppingList() {
    const [isEditing, setIsEditing] = useState<boolean>(false);
    const [userInput, setUserInput] = useState<string>('');
    const value = useGroceries();
    if (!value) {
        return <Loading />;
    }

    const { groceries, editItem, addNewItem } = value;

    function toggleCheckbox(event: ChangeEvent<HTMLInputElement>, id: Pick<Grocery, 'id'>) {
        const checked = event.target.checked;
        editItem({ isChecked: checked }, id);
    }

    return (
        <>
            <Head>
                <title>Shopping List</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/favicon.ico" />
            </Head>
            <Main>
                <Button label='Generate' />
                <GroceryList
                    items={groceries}
                    toggleCheckbox={toggleCheckbox} />
                {
                    isEditing && (
                        <ListItem>
                            <Checkbox checked={false} />
                            <input type='text' autoFocus />
                        </ListItem>
                    )
                }
                <Button
                    variant='ghost'
                    onClick={() => setIsEditing(true)}>
                    <Icon name='plus' />
                    Add an Item
                </Button>
                <GroceryList items={groceries} toggleCheckbox={toggleCheckbox} crossed />
            </Main>
        </>
    );
}